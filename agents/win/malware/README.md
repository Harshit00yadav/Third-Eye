# Payload generation

to generate a exe executable for windows compile the source code of the file with pyinstaller after activating the virtual environment

## Warning
once you send terminate signal on the agent, the AV might detect it and quarenteen the agent

## Steps
 - create a virtual environment with python on windows
 - activate the virtual environment
 - install dependencies
 - compile stub.py
```
python -m venv virtEnv
virtEnv\Scripts\activate
pip install pycryptodome
pip install requests
pip install pyinstaller
pyinstaller --onefile --noconsole stub.py
```

## Antivirus evasion

 [+] Initially
	- the main logic for the virus is written in windows_agent.txt
	- the windows_encoded_agent.py file includes all the imports required for the virus and a base64 encoded string of the virus file
	- the windows_encoded_agent.py uses the base64 encoded string to exec the virus by simply decoding the sting
	
 [+] Imporvement
  - using AES encryption to encrypt the string of windows_agent.txt with a key
	- Symmetric Encryption: Uses the same key for both encryption and decryption. Keep this key secret!
  - Cipher Block Chaining (CBC) Mode: Each block of plaintext is XORed with the previous ciphertext block before being encrypted. This mode requires an Initialization Vector (IV) for the first block.
  - Padding: AES requires the data length to be a multiple of 16 bytes. Padding is added to the plaintext to meet this requirement.
  - Initialization Vector (IV): A random value that ensures different ciphertexts even if the same plaintext and key are used multiple times.
	- and encode the encrypted string with base64 10x

 [+] Execution
  - the imporved base64 string must be decoded 10x which will result in the AES encrypter string
	- then use the previous generated key to decrypt the cypher
	- use exec function to execute the malecious code
